<!DOCTYPE html>
<html lang="en">
<head>
  <!-- First paint: dark background + no-flash gate -->
  <style>
    /* Match the app's dark theme color */
    html { background: #0b0b0f; }
    /* Hide body during the head redirect decision to avoid flicker */
    html.boot-hiding body { visibility: hidden; }
  </style>
  <script>
    // Start hidden immediately (before styles/scripts load)
    document.documentElement.classList.add('boot-hiding');
    // Fail-safe: if anything goes wrong, unhide after 1.5s
    setTimeout(function(){
      document.documentElement.classList.remove('boot-hiding');
    }, 1500);
  </script>

  <!-- Mobile UI theming (safe if duplicates are avoided) -->
  <meta name="theme-color" content="#0b0b0f">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Preload main stylesheet so styles are ready ASAP -->
  <!-- If the page already links to styles.css, add this JUST ABOVE that link -->
  <link rel="preload" href="styles.css?v=readability2" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="styles.css?v=readability2"></noscript>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard - SHEAR iQ</title>
  <link rel="stylesheet" href="styles.css?v=readability2">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>
  <script type="module" src="auth.js"></script>
  <!-- PWA manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- PWA icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
  <!-- Ultra-early launch redirect + no-flash guard -->
  <style>
    /* If a redirect is imminent, prevent any paint */
    html[data-pre-redirect] { visibility: hidden !important; }
  </style>
  <script>
    (function(){
      // Decide as early as possible if we need to redirect, then hide to prevent flash.
      function navIsCold(){
        try {
          var n = performance.getEntriesByType && performance.getEntriesByType('navigation')[0];
          return !n || n.type === 'navigate' || n.type === 'reload';
        } catch(e){ return true; }
      }
      function herePage(){
        var p = (location.pathname || '').toLowerCase();
        if (/tally\.html(\?|#|$)/.test(p)) return 'tally';
        if (/dashboard\.html(\?|#|$)/.test(p)) return 'dashboard';
        // Fallback: if unknown, leave blank and do nothing here
        return '';
      }

      var cold = navIsCold();
      var role = (localStorage.getItem('user_role') || '').toLowerCase();
      var pref = (localStorage.getItem('preferred_start') || '').toLowerCase();

      var want = role === 'contractor' ? 'dashboard'
               : role === 'staff'      ? 'tally'
               : (pref || '');

      var here = herePage();

      // >>> NEW: honor explicit user navigation <<<
      var url = new URL(location.href);
      var hasExplicitIntent =
        url.searchParams.has('view') ||
        url.searchParams.has('newDay') ||
        url.searchParams.has('loadedSession') ||
        url.searchParams.get('override') === 'tally';

      // One-time bypass set by buttons before navigating
      var launchOverride = (sessionStorage.getItem('launch_override') || '').toLowerCase();
      if (hasExplicitIntent || launchOverride === 'tally' || launchOverride === 'any') {
        // consume the one-time bypass so it doesn't affect later launches
        sessionStorage.removeItem('launch_override');
      } else if (cold && want && here && want !== here) {
        // Mark pre-redirect to prevent any visual flash
        document.documentElement.setAttribute('data-pre-redirect','1');
        // Redirect immediately before anything renders
        if (want === 'dashboard') location.replace('dashboard.html');
        else if (want === 'tally') location.replace('tally.html');
        return;
      }

      document.addEventListener('DOMContentLoaded', function(){
        document.documentElement.classList.remove('boot-hiding');
      });
    })();
  </script>
</head>
<body>
<!-- DASHBOARD HELP BUTTON -->
<button id="help-btn" aria-haspopup="true" aria-expanded="false" aria-controls="dash-help-menu" title="Help">?</button>

<!-- HELP MENU DROPDOWN -->
<div id="dash-help-menu" role="dialog" aria-modal="false" aria-labelledby="dash-help-title" hidden>
  <div class="dhm-header">
    <h3 id="dash-help-title">Help</h3>
    <button class="dhm-close" id="dhm-close" aria-label="Close help menu">&times;</button>
  </div>
  <div class="dhm-body">
    <label class="dhm-row">
      <input type="checkbox" id="toggle-welcome"> Enable Welcome Popup
    </label>
    <label class="dhm-row">
      <input type="checkbox" id="toggle-tour"> Enable Dashboard Tour
    </label>
    <div class="dhm-actions">
      <button id="btnStartTour" class="dhm-btn">Start Tour</button>
      <button id="btnSkipTour" class="dhm-btn">Skip Tour</button>
      <button id="btnSaveHelp" class="dhm-btn">Save</button>
    </div>
  </div>
</div>
    <div id="page-content" class="dashboard-container" style="display: none;">
      <div class="logo-container">
        <img src="logo.png" alt="SHEΔR iQ logo" width="1125" height="927" />
        <h2 id="dashboard-heading">Contractor Dashboard</h2>
      </div>
      <div class="dashboard-main">
        <p id="dashboard-subheading"></p>
        <!-- KPI BAR (new) -->
        <section id="kpiBar" aria-label="Key performance indicators">
          <button class="kpi-pill" id="kpiSheepCount" aria-haspopup="dialog" aria-controls="kpiSheepModal">
            <span class="kpi-label">Sheep Count</span>
            <span class="kpi-value" id="kpiSheepCountValue">—</span>
          </button>
          <button class="kpi-pill" id="kpiSheepPerHour" aria-haspopup="dialog" aria-controls="kpiSheepPerHourModal">
            <span class="kpi-label">Sheep Per Hour</span>
            <span class="kpi-value" id="kpiSheepPerHourValue">—</span>
          </button>
          <button class="kpi-pill" id="kpiTotalHours" aria-haspopup="dialog" aria-controls="kpiTotalHoursModal">
            <span class="kpi-label">Total Hours</span>
            <span class="kpi-value" id="kpiTotalHoursValue">—</span>
          </button>
          <button class="kpi-pill" id="kpiDaysWorked" aria-haspopup="dialog" aria-controls="kpiDaysWorkedModal">
            <span class="kpi-label">Days Worked</span>
            <span class="kpi-value" id="kpiDaysWorkedValue">—</span>
          </button>
        </section>

        <!-- KPI MODAL (new) -->
        <div id="kpiSheepModal" class="kpi-modal" role="dialog" aria-modal="true" aria-labelledby="kpiSheepTitle" hidden>
          <div class="kpi-modal-card">
            <header class="kpi-modal-header">
              <h2 id="kpiSheepTitle">Sheep Count — Year to Date</h2>
              <button class="kpi-close" id="kpiSheepClose" aria-label="Close">✕</button>
            </header>

            <div class="kpi-controls">
              <label>
                Year
                <select id="kpiYearSelect"></select>
              </label>
              <label>
                Farm
                <select id="kpiFarmSelect">
                  <option value="__ALL__">All farms</option>
                </select>
              </label>
              <small id="kpiOfflineNote" class="kpi-note" hidden>Offline data may be incomplete.</small>
            </div>

            <div class="kpi-sections">
              <section>
                <h3>Full Sheep (excludes crutched)</h3>
                <table class="kpi-table" id="kpiFullSheepTable">
                  <thead>
                    <tr><th>Sheep Type</th><th>Total</th><th>% of Full</th><th>Farms</th><th>Top Farm (day)</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </section>

              <section>
                <h3>Crutched</h3>
                <table class="kpi-table" id="kpiCrutchedTable">
                  <thead>
                    <tr><th>Sheep Type</th><th>Total</th><th>% of Crutched</th><th>Farms</th><th>Top Farm (day)</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </section>
            </div>

            <footer class="kpi-actions">
              <button id="kpiExportCsv">Export CSV</button>
              <button id="kpiSheepCloseFooter">Close</button>
            </footer>
          </div>
        </div>

        <div id="kpiSheepPerHourModal" class="kpi-modal" role="dialog" aria-modal="true" aria-labelledby="kpiSheepPerHourTitle" hidden>
          <div class="kpi-modal-card">
            <header class="kpi-modal-header">
              <h2 id="kpiSheepPerHourTitle">Sheep Per Hour Breakdown</h2>
              <button class="kpi-close" id="kpiSheepPerHourClose" aria-label="Close">✕</button>
            </header>

            <div class="kpi-controls">
              <label>
                Farm
                <select id="kpiSPHFarmSelect">
                  <option value="__ALL__">All farms</option>
                </select>
              </label>
              <label>
                Sheep Type
                <select id="kpiSPHTypeSelect">
                  <option value="__ALL__">All types</option>
                </select>
              </label>
              <label>
                Sort By
                <select id="kpiSPHSortSelect">
                  <option value="hours">Total Hours</option>
                  <option value="sheep">Total Sheep</option>
                  <option value="rate">Sheep/Hour</option>
                  <option value="name">Shearer Name</option>
                </select>
              </label>
              <button id="kpiSPHClearFilters" class="kpi-clear">Clear Filters</button>
            </div>

            <table class="kpi-table" id="kpiSPHTable">
              <thead>
                <tr><th>Shearer</th><th>Total Sheep</th><th>Total Hours</th><th>Sheep/Hour</th></tr>
              </thead>
              <tbody></tbody>
            </table>

            <footer class="kpi-actions">
              <button id="kpiSheepPerHourCloseFooter">Close</button>
            </footer>
          </div>
        </div>

        <div id="kpiTotalHoursModal" class="kpi-modal" role="dialog" aria-modal="true" aria-labelledby="kpiTotalHoursTitle" hidden>
          <div class="kpi-modal-card">
            <header class="kpi-modal-header">
              <h2 id="kpiTotalHoursTitle">Total Hours — Session vs Crew</h2>
              <button class="kpi-close" id="kpiTotalHoursClose" aria-label="Close">✕</button>
            </header>

            <div class="kpi-controls">
              <label>
                Year
                <select id="kpiTHYearSelect"></select>
              </label>
              <label>
                Farm
                <select id="kpiTHFarmSelect">
                  <option value="__ALL__">All farms</option>
                </select>
              </label>
              <small id="kpiTHOfflineNote" class="kpi-note" hidden>Offline data may be incomplete.</small>
            </div>

            <div class="kpi-sections">
              <section>
                <h3>Summary</h3>
                <table class="kpi-table">
                  <thead>
                    <tr><th>Metric</th><th>Total Hours</th></tr>
                  </thead>
                  <tbody id="kpiTHSummary">
                    <!-- Filled by JS -->
                  </tbody>
                </table>
                <small class="kpi-note">
                  <strong>Session Hours</strong> = actual shed operating time per session.<br>
                  <strong>Total Crew Hours</strong> = combined individual hours for all people in a session.<br>
                  <strong>Shed Staff Hours</strong> = combined individual hours for shed staff only.
                </small>
              </section>

              <section>
                <h3>By Farm</h3>
                <table class="kpi-table" id="kpiTHByFarm">
                  <thead>
                    <tr>
                      <th>Farm</th>
                      <th>Session Hours</th>
                      <th>Shed Staff Hours</th>
                      <th>Avg Session Length</th><!-- NEW -->
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </section>

              <section>
                <h3>By Shearer</h3>
                <table class="kpi-table" id="kpiTHByPerson">
                  <thead>
                    <tr><th>#</th><th>Shearer</th><th>Days Worked</th><th>Total Hours</th><th>Avg Hours/Day</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </section>

              <section>
                <h3>By Shed Staff</h3>
                <table class="kpi-table" id="kpiTHByStaff">
                  <thead>
                    <tr><th>#</th><th>Staff</th><th>Days Worked</th><th>Total Hours</th><th>Avg Hours/Day</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </section>

              <section>
                <h3>By Month</h3>
                <!-- Add this directly above the existing #kpiTHByMonth table -->
                <div id="kpiTHMonthTrend" class="kpi-trend">
                  <div class="kpi-badges" id="kpiTHPeaks" aria-live="polite">
                    <span class="kpi-badge kpi-pill" id="kpiTHBusiestBadge" hidden>Busiest: —</span>
                    <span class="kpi-badge kpi-pill" id="kpiTHQuietestBadge" hidden>Quietest: —</span>
                  </div>
                  <div id="kpiTHMonthSpark" class="kpi-spark" role="img" aria-label="Monthly session-hours trend"></div>
                </div>
                <table class="kpi-table" id="kpiTHByMonth">
                  <thead>
                    <tr><th>Month</th><th>Session Hours</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </section>
            </div>

            <footer class="kpi-actions">
          <button id="kpiTHExport">Export CSV</button>
          <button id="kpiTotalHoursCloseFooter">Close</button>
        </footer>
      </div>
    </div>

      <div id="kpiDaysWorkedModal" class="kpi-modal" role="dialog" aria-modal="true" aria-labelledby="kpiDaysWorkedTitle" hidden>
        <div class="kpi-modal-card">
          <header class="kpi-modal-header">
            <h2 id="kpiDaysWorkedTitle">Days Worked — Unique Session Days</h2>
            <button class="kpi-close" id="kpiDaysWorkedClose" aria-label="Close">✕</button>
          </header>

          <div class="kpi-controls">
            <label>
              Year
              <select id="kpiDWYearSelect"></select>
            </label>
            <label>
              Farm
              <select id="kpiDWFarmSelect">
                <option value="__ALL__">All farms</option>
              </select>
            </label>
            <small id="kpiDWOfflineNote" class="kpi-note" hidden>Offline data may be incomplete.</small>
          </div>

          <div class="kpi-sections">
            <section>
              <h3>Summary</h3>
              <div id="kpiDWReliability" class="kpi-trend">
                <div class="kpi-badges" id="kpiDWBadges" aria-live="polite">
                  <span class="kpi-badge kpi-pill" id="kpiDWHighestAttendance" hidden>Highest Attendance: —</span>
                  <span class="kpi-badge kpi-pill" id="kpiDWMostConsecutiveDays" hidden>Most Consecutive Days: —</span>
                </div>
              </div>
              <table class="kpi-table">
                <thead><tr><th>Metric</th><th>Count</th></tr></thead>
                <tbody id="kpiDWSummary"></tbody>
              </table>
              <p class="kpi-note">Each work day is only counted once, even if multiple teams worked that day.</p>
            </section>

            <section>
              <h3>By Farm</h3>
              <table class="kpi-table" id="kpiDWByFarm">
                <thead>
                  <tr>
                    <th>Farm</th>
                    <th>Days Worked</th>
                    <th>Total Staff Used</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </section>

            <section>
              <h3>By Person</h3>
              <table class="kpi-table" id="kpiDWByPerson">
                <thead><tr><th>#</th><th>Name</th><th>Role</th><th>Days Worked</th></tr></thead>
                <tbody></tbody>
              </table>
            </section>

            <section>
              <h3>Streaks (Consecutive Days Worked)</h3>
              <table class="kpi-table" id="kpiDWStreaks">
                <thead>
                  <tr>
                    <th>#</th><th>Name</th><th>Role</th><th>Longest Streak</th><th>Streak Period</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </section>

            <section>
              <h3>By Month</h3>
              <div id="kpiDWMonthTrend" class="kpi-trend">
                <div class="kpi-badges" id="kpiDWMonthPeaks" aria-live="polite">
                  <span class="kpi-badge kpi-pill" id="kpiDWBusiestMonth" hidden>Busiest Month: —</span>
                  <span class="kpi-badge kpi-pill" id="kpiDWQuietestMonth" hidden>Quietest Month: —</span>
                  <span class="kpi-badge kpi-pill" id="kpiDWMonthlyAverage" hidden>Monthly Average: —</span>
                </div>
                <div id="kpiDWMonthSpark" class="kpi-spark" role="img" aria-label="Monthly days-worked trend"></div>
              </div>
              <table class="kpi-table" id="kpiDWByMonth">
                <thead><tr><th>Month</th><th>Days Worked</th></tr></thead>
                <tbody></tbody>
              </table>
            </section>
          </div>

          <footer class="kpi-actions">
            <button id="kpiDWExport">Export CSV</button>
            <button id="kpiDaysWorkedCloseFooter">Close</button>
          </footer>
        </div>
      </div>

        <div id="siq-widgets-grid">
        <!-- BEGIN: Top 5 Shearers Widget -->
        <section id="top5-shearers" class="dash-card top5-widget">
          <header class="dash-card__header">
            <h2 class="dash-card__title">Top 5 Shearers</h2>
            <div class="dash-card__controls">
              <!-- Work type tabs -->
              <div class="siq-segmented" id="worktype-tabs">
                <button type="button" data-worktype="shorn" class="siq-segmented__btn is-active">Shorn</button>
              <button type="button" data-worktype="crutched" class="siq-segmented__btn">Crutched</button>
            </div>
            <!-- View selector -->
            <div class="view-select">
              <label for="shearers-view">View</label>
              <select id="shearers-view">
                <option value="12m" selected>12M Rolling</option>
                <option value="all">All‑Time</option>
              </select>
              <select id="shearers-year" class="year-select" aria-label="Specific year" hidden></select>
            </div>
            <button type="button" id="shearers-viewall" class="siq-link-button">View Full List</button>
          </div>
        </header>

          <div id="top5-shearers-list" class="siq-leaderboard">
            <!-- JS renders 5 rows with bars -->
          </div>
        </section>
        <!-- BEGIN: Top 5 Shed Staff Widget -->
        <section id="top5-shedstaff" class="dash-card top5-widget">
          <header class="dash-card__header">
            <h2 class="dash-card__title">Top 5 Shed Staff — Hours Worked</h2>
            <div class="dash-card__controls">
              <div class="view-select">
                <label for="shedstaff-view">View</label>
                <select id="shedstaff-view">
                  <option value="12m" selected>12M Rolling</option>
                  <option value="all">All‑Time</option>
                </select>
                <select id="shedstaff-year" class="year-select" aria-label="Specific year" hidden></select>
              </div>
              <button type="button" id="shedstaff-viewall" class="siq-link-button">View Full List</button>
            </div>
          </header>

          <div id="top5-shedstaff-list" class="siq-leaderboard">
            <!-- JS renders 5 rows with bars -->
          </div>
        </section>
        <!-- BEGIN: Top 5 Farms Widget -->
        <section id="top5-farms" class="dash-card top5-widget">
          <header class="dash-card__header">
            <h2 class="dash-card__title">Top 5 Farms</h2>
            <div class="dash-card__controls">
              <div class="view-select">
                <label for="farms-view">View</label>
                <select id="farms-view">
                  <option value="12m" selected>12M Rolling</option>
                  <option value="all">All‑Time</option>
                </select>
                <select id="farms-year" class="year-select" aria-label="Specific year" hidden></select>
              </div>
              <button type="button" id="farms-viewall" class="siq-link-button">View All</button>
            </div>
          </header>
          <div id="top5-farms-list" class="siq-leaderboard">
            <!-- JS renders 5 rows with bars -->
          </div>
        </section>
        </div>
        <!-- Full list modal -->
        <div id="shearers-modal" class="siq-modal" aria-hidden="true">
          <div class="siq-modal__backdrop" data-close-modal></div>
          <div class="siq-modal__panel">
            <header class="siq-modal__header">
              <h3>All Shearers — Rankings</h3>
              <button class="siq-modal__close" data-close-modal aria-label="Close">&times;</button>
            </header>
            <div class="siq-modal__body">
              <div class="siq-table-scroll">
                <table class="siq-rank-table" id="shearers-full-table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Shearer</th>
                      <th>Total Sheep</th>
                      <th>% of Total</th>
                    </tr>
                  </thead>
                  <tbody><!-- JS fills --></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- END: Top 5 Shearers Widget -->
        <!-- Full list modal -->
        <div id="shedstaff-modal" class="siq-modal" aria-hidden="true">
          <div class="siq-modal__backdrop" data-close-modal></div>
          <div class="siq-modal__panel">
            <header class="siq-modal__header">
              <h3>All Shed Staff — Rankings</h3>
              <button class="siq-modal__close" data-close-modal aria-label="Close">&times;</button>
            </header>
            <div class="siq-modal__body">
              <div class="siq-table-scroll">
                <table class="siq-rank-table" id="shedstaff-full-table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Hours</th>
                      <th>Days Worked</th>
                    </tr>
                  </thead>
                  <tbody><!-- JS fills --></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- END: Top 5 Shed Staff Widget -->
        <!-- Full list modal -->
        <div id="farms-full-modal" class="siq-modal" aria-hidden="true">
          <div class="siq-modal__backdrop" data-close-modal></div>
          <div class="siq-modal__panel">
            <header class="siq-modal__header">
              <h3>All Farms — Rankings</h3>
              <button class="siq-modal__close" data-close-modal aria-label="Close">&times;</button>
            </header>
            <div class="siq-modal__body">
              <div class="siq-table-scroll">
                <table class="siq-rank-table" id="farms-full-table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Farm</th>
                      <th>Sheep</th>
                      <th>Visits</th>
                      <th>Avg/Visit</th>
                      <th>Last Visit</th>
                    </tr>
                  </thead>
                  <tbody><!-- JS fills --></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- END: Top 5 Farms Widget -->
        <section class="dashboard-buttons">
          <button id="btnManageStaff" class="tab-button">Manage Staff</button>
          <button id="btnStartNewDay" class="tab-button">Start New Day</button>
          <button id="btnViewSavedSessions" class="tab-button">View Saved Sessions</button>
          <button id="btnReturnToActive" class="tab-button" style="display: none;">Return to Active Session</button>
          <button id="farm-summary-btn" class="dashboard-button">Farm Summary</button>
          <button id="btnChangePin" class="tab-button">Change Contractor PIN</button>
          <button id="btnChangePassword" class="tab-button">Change Password</button>
          <button id="btnSettings" class="tab-button">Settings / Preferences</button>
          <button id="logoutBtn" class="tab-button">Logout</button>
        </section>
      </div>
    </div>

  <script type="module" src="dashboard.js"></script>
  <div id="loading-overlay">
    <div class="circle-spinner"></div>
    <div>Authenticating… Please wait</div>
  </div>
<!-- DASHBOARD WELCOME MODAL -->
<div id="dashboard-welcome-overlay" aria-hidden="true">
  <div id="dashboard-welcome-modal" role="dialog" aria-modal="true" aria-labelledby="dw-title" aria-describedby="dw-desc">
    <div class="dw-header">
      <h3 id="dw-title">Welcome to the Contractors Dashboard</h3>
      <button class="dw-close" id="dw-close" aria-label="Close welcome modal">&times;</button>
    </div>
    <div class="dw-body" id="dw-desc">
      <p>This dashboard lets you manage your shearing operation quickly and safely. Here’s a quick overview of features and functions, and you can run a guided tour anytime from the Help menu.</p>
      <ul class="dw-list">
        <li><strong>Key Metrics</strong>: Quick KPI pills for sheep count, rate, hours, and days worked; tap any pill for details.</li>
        <li><strong>Top 5 Shearers</strong>: See leaders; open “View Full List”.</li>
        <li><strong>Top 5 Shed Staff</strong>: Track hours worked; open “View Full List”.</li>
        <li><strong>Top 5 Farms</strong>: View leading farms; open “View All”.</li>
        <li><strong>Manage Staff</strong>: Add/remove staff; see online/last seen.</li>
        <li><strong>Saved Sessions</strong>: Reopen past days.</li>
        <li><strong>Return to Active</strong>: Jump back to an unfinished tally (if shown).</li>
        <li><strong>Start New Day</strong>: Begin today’s tally.</li>
        <li><strong>Farm Summary</strong>: Totals and comparisons by farm.</li>
        <li><strong>Guided Tour</strong>: Walk through the dashboard interactively from the Help menu.</li>
        <li><strong>Change Contractor PIN</strong>: Keep control and security tight.</li>
        <li><strong>Change Password</strong>: Update your login password securely.</li>
        <li><strong>Settings / Preferences</strong>: Coming soon (not yet enabled).</li>
        <li><strong>Logout</strong>: Safely sign out.</li>
      </ul>
      <div class="dw-row" style="margin-top:10px; display:flex; gap:14px; align-items:center; flex-wrap:wrap;">
        <label class="dw-inline">
          <input type="checkbox" id="dw-enable-welcome">
          Enable Welcome Popup
        </label>
        <label class="dw-inline">
          <input type="checkbox" id="dw-enable-tour">
          Enable Dashboard Tour
        </label>
        <label class="dw-inline">
          <input type="checkbox" id="dw-dont-show">
          Don’t show again
        </label>
      </div>
    </div>
    <div class="dw-footer">
      <button class="dw-btn" id="dw-help">Open Help Menu</button>
      <button class="dw-btn" id="dw-start">Start Tour</button>
      <button class="dw-btn" id="dw-save">Save</button>
      <button class="dw-btn primary" id="dw-ok">Got it</button>
    </div>
  </div>
</div>
  <script src="serviceworker.js"></script>
  <script src="/pwa-suppress-install.js" defer></script>
  <script src="app-launch-guard.js" defer></script>
  <script>
    try {
      localStorage.setItem('user_role', 'contractor');
      localStorage.setItem('preferred_start', 'dashboard');
    } catch(e) {}
  </script>
</body>
</html>
